<!-- Resumen de Fotos Ya Procesadas -->
<div class="container-fluid" style="margin-top: 70px; padding: 2rem;">
  
  <!-- Header -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 class="mb-1 text-white">
          <i class="fas fa-check-circle text-success me-2"></i>
          Fotos Ya Procesadas
        </h2>
        <p class="text-muted mb-0">
          {% if fotos %}
            {{ fotos|length }} foto{{ 's' if fotos|length != 1 else '' }} ya {{ 'tienen' if fotos|length != 1 else 'tiene' }} personas identificadas
          {% else %}
            No hay fotos procesadas
          {% endif %}
        </p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-primary"
                hx-get="/ver-todas-fotos"
                hx-target="#panel-content"
                hx-swap="innerHTML">
          <i class="fas fa-images me-2"></i>Ver Todas las Fotos
        </button>
        <button class="btn btn-outline-secondary"
                hx-get="/subir_foto"
                hx-target="#panel-content"
                hx-swap="innerHTML">
          <i class="fas fa-plus me-2"></i>Subir Más Fotos
        </button>
      </div>
    </div>
  </div>

  {% if fotos %}
    <!-- Grid de fotos procesadas -->
    <div class="row g-4">
      {% for foto in fotos %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm border-success">
            <!-- Imagen de la foto -->
            <div class="position-relative" style="height: 250px; overflow: hidden;">
              <img src="{{ foto.foto_url }}" 
                   alt="{{ foto.foto_nombre }}"
                   class="card-img-top w-100 h-100"
                   style="object-fit: cover;"
                   loading="lazy">
              
              <!-- Badge de estado procesado -->
              <div class="position-absolute top-0 end-0 m-2">
                <span class="badge bg-success">
                  <i class="fas fa-check me-1"></i>Procesada
                </span>
              </div>
              
              <!-- Badge con número de personas -->
              <div class="position-absolute bottom-0 start-0 m-2">
                <span class="badge bg-dark bg-opacity-75">
                  <i class="fas fa-users me-1"></i>{{ foto.personas_count }} persona{{ 's' if foto.personas_count != 1 else '' }}
                </span>
              </div>
            </div>
            
            <!-- Información de la foto -->
            <div class="card-body">
              <h6 class="card-title text-truncate mb-2">
                {{ foto.foto_nombre }}
              </h6>
              
              <!-- Lista de personas identificadas -->
              {% if foto.personas_nombres %}
                <div class="mb-3">
                  <small class="text-muted d-block mb-1">
                    <i class="fas fa-user-tag me-1"></i>Personas identificadas:
                  </small>
                  <div class="d-flex flex-wrap gap-1">
                    {% for nombre in foto.personas_nombres %}
                      <span class="badge bg-primary">{{ nombre }}</span>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
              
              <!-- Botones de acción -->
              <div class="d-flex gap-2 mt-3">
                <button class="btn btn-sm btn-outline-primary flex-fill"
                        onclick="verDetallesFoto({{ foto.foto_id }})">
                  <i class="fas fa-eye me-1"></i>Ver Detalles
                </button>
                <button class="btn btn-sm btn-outline-warning"
                        onclick="reprocesarFoto({{ foto.foto_id }})">
                  <i class="fas fa-redo me-1"></i>Re-procesar
                </button>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Información adicional -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          <strong>¿Qué significa esto?</strong> Estas fotos ya han sido procesadas y tienen personas identificadas. 
          Si quieres cambiar las identificaciones, puedes usar el botón "Re-procesar" en cada foto.
        </div>
      </div>
    </div>
    
  {% else %}
    <!-- Estado vacío -->
    <div class="text-center py-5">
      <i class="fas fa-images text-muted" style="font-size: 4rem;"></i>
      <h4 class="text-muted mt-3">No hay fotos procesadas</h4>
      <p class="text-muted">Las fotos que subas y proceses aparecerán aquí.</p>
      <button class="btn btn-primary"
              hx-get="/subir_foto"
              hx-target="#panel-content"
              hx-swap="innerHTML">
        <i class="fas fa-plus me-2"></i>Subir Primera Foto
      </button>
    </div>
  {% endif %}
</div>

<script>
function verDetallesFoto(fotoId) {
    // Redirigir a la galería con la foto específica
    htmx.ajax('GET', '/ver-todas-fotos', {
        target: '#panel-content',
        swap: 'innerHTML'
    });
}

function reprocesarFoto(fotoId) {
    if (confirm('¿Estás seguro de que quieres volver a procesar esta foto? Se perderán las identificaciones actuales.')) {
        // Limpiar personas_ids de la foto y reprocesar
        htmx.ajax('GET', `/api/procesar-reconocimiento-facial?ids=${fotoId}&force=true`, {
            target: '#panel-content',
            swap: 'innerHTML'
        });
    }
}
</script>